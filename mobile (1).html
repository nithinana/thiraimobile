<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thirai - Streaming</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ==============================================
           1. CORE VARIABLES & RESET
           ============================================== */
        :root {
            --bg-body: #080808;
            --bg-card: #121212;
            --text-main: #ffffff;
            --text-muted: #b3b3b3;
            --accent: #e50914;
            --header-height: 75px;
            --radius: 6px;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        a { text-decoration: none; color: inherit; }
        .visually-hidden { display: none !important; }

        /* ==============================================
           2. HEADER (PC: Logo | Nav | Search)
           ============================================== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--header-height);
            display: flex;
            align-items: center;
            padding: 0 40px;
            /* Default PC Header Background */
            background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
            z-index: 100;
            transition: background 0.4s ease, background-color 0.4s ease;
        }
        
        .header.scrolled {
            background-color: #000000; /* Bold black on scroll */
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            width: 100%;
            max-width: 1500px;
            margin: 0 auto;
            justify-content: flex-start;
            gap: 25px; 
            position: relative;
            z-index: 2;
        }

        .logo { 
            height: 28px; 
            margin-right: 0;
            cursor: pointer;
        }

        .nav-menu {
            display: flex;
            gap: 20px; 
            margin: 0 25px 0 0; /* Add space for PC search bar */
        }

        .nav-link {
            font-size: 0.95rem;
            color: var(--text-muted);
            font-weight: 500;
            transition: color 0.2s;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--text-main);
        }
        
        .nav-link.active {
            font-weight: 700;
        }

        /* --- PC SEARCH INPUT STYLES (Always visible on PC) --- */
        .pc-search-container {
            position: relative;
            width: 100%; 
            max-width: 300px;
            margin-left: auto; /* Push to the right */
        }
        
        .pc-search-container .search-icon {
            left: 15px;
        }


        /* --- SEARCH BAR BASE STYLES (Used by both PC and Mobile Search View) --- */
        .search-container {
            position: relative;
            width: 100%; 
            max-width: 600px; 
            margin: 0 auto; 
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
            font-size: 0.9rem;
            pointer-events: none;
            z-index: 3; /* Above the input */
        }

        .search-input {
            width: 100%;
            /* Cleaner and Curved Style */
            background-color: #1c1c1c; 
            border: none; 
            border-radius: 30px; /* Fully curved */
            padding: 10px 15px 10px 40px; /* Increased left padding for icon */
            color: white;
            font-family: inherit;
            font-size: 1.1rem; 
            height: 40px;
            transition: background-color 0.2s, box-shadow 0.2s;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1); /* Subtle inner border */
        }

        .search-input:focus {
            background-color: #242424;
            box-shadow: 0 0 0 2px var(--text-main), inset 0 0 0 1px var(--text-main); /* White ring on focus */
        }
        
        .search-input::placeholder {
            color: #777;
        }


        /* ==============================================
           3. HERO SECTION (PC Slideshow)
           ============================================== */
        .hero {
            height: 80vh;
            min-height: 550px;
            position: relative;
            display: flex;
            align-items: flex-end;
            padding-bottom: 80px;
            margin-bottom: 20px;
        }

        .hero-bg {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: top center;
            transition: background-image 1s ease-in-out;
            z-index: 1;
        }

        .hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(0deg, var(--bg-body) 0%, rgba(8,8,8,0.6) 50%, rgba(8,8,8,0.3) 100%);
            z-index: 2;
        }

        .hero-content {
            position: relative;
            z-index: 3;
            padding-left: 40px;
            max-width: 650px;
            transition: opacity 0.5s; 
        }

        .hero-meta {
            color: var(--accent);
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .hero-rating {
            color: #fff;
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8rem;
        }
        
        .hero-title-container {
            min-height: 100px;
            margin: 0 0 15px 0;
        }

        .hero-logo {
            max-width: 450px;
            height: auto;
            max-height: 100px;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            margin: 0;
            line-height: 1.1;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }

        .hero p {
            font-size: 1.1rem;
            line-height: 1.5;
            color: #ddd;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 25px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }

        .btn-play {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background-color: var(--accent);
            color: white;
            padding: 12px 30px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: background-color 0.2s, box-shadow 0.2s, transform 0.2s;
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.4);
            border: none;
        }

        .btn-play:hover {
            transform: scale(1.02);
            background-color: #ff1f29;
            box-shadow: 0 6px 20px rgba(229, 9, 20, 0.6);
        }
        
        .btn-play:active {
            background-color: #c40810;
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* ==============================================
           4. ROWS & GRID & TAB TRANSITIONS & SEARCH VIEW
           ============================================== */
        .section-title {
            padding: 0 40px;
            margin-bottom: 15px;
            font-size: 1.4rem;
            font-weight: 700;
            margin-top: 30px;
        }

        #view-movies, #view-tv {
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }
        #view-movies.is-fading, #view-tv.is-fading {
            opacity: 0;
        }

        .row-container {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 40px 30px;
            scroll-behavior: smooth;
            scrollbar-color: #333 transparent;
            scrollbar-width: thin;
        }
        
        .row-container::-webkit-scrollbar { height: 8px; }
        .row-container::-webkit-scrollbar-thumb {
            background-color: #333;
            border-radius: 4px;
        }
        .row-container::-webkit-scrollbar-track { background-color: transparent; }

        .card {
            flex: 0 0 auto;
            width: 170px;
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
            background: #1a1a1a;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            aspect-ratio: 2/3;
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card:hover {
            transform: translateY(-5px) scale(1.08);
            box-shadow: 0 20px 40px rgba(0,0,0,0.8);
            z-index: 10;
        }
        
        .card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .card:hover::after {
            opacity: 1;
        }

        #search-view {
            padding-top: 100px; 
            min-height: 100vh;
        }
        
        .search-bar-container {
            padding: 0 40px; 
            margin-bottom: 30px;
        }

        .grid-layout {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            padding: 0 40px 30px; 
        }
        
        .grid-layout .card { width: 100%; }
        
        .search-results-container { display: none; }


        /* ==============================================
           5. MOBILE UI 
           ============================================== */
        
        .mobile-hero-container {
            display: none; 
            padding-top: 0; 
            position: relative;
            width: 100%;
            height: 60vh; 
            max-height: 500px;
            margin-bottom: 20px;
        }
        
        .mobile-hero-slide {
            width: 100%;
            height: 100%;
            display: block; 
            padding: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .mobile-hero-poster-box {
            position: relative;
            width: 100%; 
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            background: var(--bg-card);
            box-shadow: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end; 
            text-align: center;
        }

        .mobile-hero-poster-box img.backdrop-art {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center top; 
            z-index: 1;
        }

        .mobile-hero-overlay-gradient {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.95) 90%, #080808 100%);
            z-index: 2;
        }

        .mobile-hero-content {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 3;
            padding: 0 20px 30px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: transparent;
        }

        .mobile-hero-logo {
            max-width: 80%;
            height: auto;
            max-height: 80px; /* MADE BIGGER */
            margin-bottom: 15px;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.6));
        }
        
        /* Play Button Style */
        .mobile-hero-play {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 24px;
            border-radius: 30px; 
            background: rgba(255, 255, 255, 0.95);
            color: #000;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transition: transform 0.2s, background 0.2s;
            backdrop-filter: blur(4px);
        }
        
        .mobile-hero-play i {
            font-size: 0.9rem;
            color: #000;
        }

        .mobile-hero-play:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.8);
        }
        
        /* Bottom Nav Styling */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            display: none; 
            justify-content: space-around;
            align-items: center;
            background-color: #000000;
            border-top: 1px solid #1a1a1a;
            z-index: 200;
        }
        
        .bottom-nav .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-muted);
            font-size: 0.7rem;
            font-weight: 500;
            transition: color 0.2s;
            cursor: pointer;
            padding: 5px;
        }

        .bottom-nav .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 2px;
        }

        .bottom-nav .nav-item.active {
            color: var(--accent);
        }

        /* Media Query for PC Overrides (>= 769px) */
        @media screen and (min-width: 769px) {
            .pc-search-container {
                display: block; /* Show PC Search */
            }
        }


        /* Media Query for Mobile Overrides (<= 768px) */
        @media screen and (max-width: 768px) {
            .header {
                padding: 0 20px;
                height: 60px;
                background: transparent;
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
                justify-content: center; 
                position: fixed; 
            }

            /* The Fading Black Background Layer (Mobile only) */
            .header::before {
                content: '';
                position: absolute;
                inset: 0; 
                z-index: -1; 
                
                /* Gradient: Solid Black at top fading to Transparent at bottom */
                background: linear-gradient(180deg, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 100%);
                
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
                
                transition: opacity 0.3s ease;
            }
            
            .header-content {
                justify-content: center; 
                width: auto; 
                gap: 0;
            }
            
            /* Hide PC search on mobile */
            .pc-search-container {
                display: none; 
            }
            
            /* SCROLLED STATE: Solid Black, No Fade Layer */
            .header.scrolled {
                background-color: #000000; 
                box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            }
            
            /* Hide the gradient/fade layer when scrolled to avoid conflict */
            .header.scrolled::before {
                opacity: 0;
            }

            .pc-hero { display: none !important; }
            .header .nav-menu { display: none; }

            .mobile-hero-container { display: block; }
            .bottom-nav { display: flex; }
            
            body { padding-bottom: 60px; }
            
            .section-title { padding: 0 20px; font-size: 1.2rem; }
            
            .row-container { 
                padding: 10px 20px 20px; 
                -ms-overflow-style: none; scrollbar-width: none; 
            }
            .row-container::-webkit-scrollbar { display: none; }
            .card { width: 130px; }
            
            /* Grid layout for search section posters on mobile */
            #search-recommendations .row-container, 
            .grid-layout { 
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); 
                gap: 10px;
                overflow-x: hidden;
                padding: 10px 20px 30px; 
            }
            
            /* Override to keep browse view rows horizontal */
            #browse-view .row-container {
                display: flex;
                overflow-x: auto;
            }

            #search-view { 
                padding-top: 80px; 
            }
            .search-bar-container {
                padding: 0 20px; 
            }
            /* Cards in the search grid must be 100% of their grid cell */
            #search-recommendations .card, .grid-layout .card { width: 100%; }
        }
    </style>
</head>
<body>

    <header class="header" id="main-header">
        <div class="header-content">
            <a href="https://thirai.me/">
                <img src="https://thirai.me/static/thiraiwhite.png" alt="Thirai" class="logo">
            </a>
            
            <nav class="nav-menu">
                <div class="nav-link active" onclick="switchTab('movies')" id="tab-movies">Movies</div>
                <div class="nav-link" onclick="switchTab('tv')" id="tab-tv">TV Shows</div>
            </nav>
            
            <div class="pc-search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input pc-search-input" id="pc-search-input" placeholder="Search for movies or shows...">
            </div>
        </div>
    </header>

    <div id="search-view" class="visually-hidden">
        
        <div class="search-bar-container">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="mobile-search-input" placeholder="Search for movies or shows...">
            </div>
        </div>

        <div id="search-recommendations">
            <div class="section-title">Popular Searches</div>
            <div class="row-container" id="row-search-recos"></div>
        </div>

        <div class="search-results-container">
            <div class="section-title" id="search-results-title">Search Results</div>
            <div class="grid-layout" id="search-grid"></div>
        </div>

    </div>

    <div id="browse-view">
        
        <div class="hero pc-hero">
            <div id="hero-bg" class="hero-bg"></div>
            <div class="hero-overlay"></div>
            <div class="hero-content" id="pc-hero-content-box">
                <div class="hero-meta">
                    <span id="hero-type">TRENDING</span>
                    <span class="hero-rating" id="hero-rating">8.5</span>
                </div>
                <div class="hero-title-container" id="hero-title-container">
                    <h1 id="hero-title">Loading...</h1>
                </div>
                <p id="hero-desc">Please wait while we fetch the latest content.</p>
                <a id="hero-play" href="#" class="btn-play">
                    <i class="fas fa-play"></i> Watch Now
                </a>
            </div>
        </div>
        
        <div class="mobile-hero-container">
            <div class="mobile-hero-slide" id="mobile-hero-slide">
                </div>
        </div>

        <div id="view-movies" class="">
            <div class="section-title">Trending Movies</div>
            <div class="row-container" id="row-popular-movies"></div>
            
            <div class="section-title">Top Rated Movies</div>
            <div class="row-container" id="row-top-movies"></div>
        </div>

        <div id="view-tv" class="visually-hidden">
            <div class="section-title">Popular TV Series</div>
            <div class="row-container" id="row-popular-tv"></div>
            
            <div class="section-title">Top Rated Shows</div>
            <div class="row-container" id="row-top-tv"></div>
        </div>

    </div>
    
    <div class="bottom-nav" id="bottom-nav">
        <div class="nav-item active" onclick="switchTab('movies')">
            <i class="fas fa-film"></i>
            <span>Movies</span>
        </div>
        <div class="nav-item" onclick="switchTab('tv')">
            <i class="fas fa-tv"></i>
            <span>TV Shows</span>
        </div>
        <div class="nav-item" onclick="switchTab('search')">
            <i class="fas fa-search"></i>
            <span>Search</span>
        </div>
    </div>

    <script>
        const API_KEY = '926e94b0f70b5bed8417b679652366ab';
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMG_POSTER = 'https://image.tmdb.org/t/p/w342';
        const IMG_BACKDROP = 'https://image.tmdb.org/t/p/original'; 
        const APP_URL = 'https://thirai.me/';

        const mobileSearchInput = document.getElementById('mobile-search-input');
        const pcSearchInput = document.getElementById('pc-search-input');
        let searchTimeout;

        let moviesData = [];
        let tvData = [];
        let slideInterval;
        let currentSlideIndex = 0;
        let activeSlideData = [];

        // --- API HELPER ---
        async function fetchData(endpoint, params = '') {
            try {
                const r = await fetch(`${BASE_URL}${endpoint}?api_key=${API_KEY}&language=en-US${params}`);
                return await r.json();
            } catch (e) { 
                console.error("Error fetching data:", e);
                return { results: [], logos: [] }; 
            }
        }
        
        async function getMovieLogo(id, type) {
            try {
                const r = await fetchData(`/${type}/${id}/images`, '&include_image_language=en,null');
                const logos = r.logos || [];
                const logo = logos.find(l => l.iso_639_1 === 'en' || l.iso_639_1 === null);
                return logo ? logo.file_path : null;
            } catch (e) {
                return null;
            }
        }

        // --- RENDER HELPERS ---
        function createCard(item, type) {
            const mediaType = item.media_type || type;
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `<img src="${IMG_POSTER}${item.poster_path}" loading="lazy" alt="${item.title || item.name}">`;
            div.addEventListener('click', () => {
                const url = mediaType === 'movie' ? `${APP_URL}player.html?${item.id}` : `${APP_URL}show.html?${item.id}`;
                window.location.href = url;
            });
            return div;
        }

        function renderRow(id, data, type) {
            const container = document.getElementById(id);
            container.innerHTML = '';
            data.forEach(item => {
                if(item.poster_path) container.appendChild(createCard(item, type));
            });
        }
        
        function renderRecommendations(id, data) {
             const container = document.getElementById(id);
             container.innerHTML = '';
             const uniqueData = Array.from(new Set(data.map(i => i.id))).map(id => data.find(i => i.id === id));
             uniqueData.slice(0, 15).forEach(item => {
                if (item.poster_path) container.appendChild(createCard(item, item.media_type || 'movie')); 
            });
        }

        // --- INITIALIZATION ---
        async function init() {
            const [popMovies, topMovies, popTV, topTV] = await Promise.all([
                fetchData('/movie/popular'),
                fetchData('/movie/top_rated'),
                fetchData('/tv/popular'),
                fetchData('/tv/top_rated')
            ]);

            moviesData = popMovies.results || [];
            tvData = popTV.results || [];

            renderRow('row-popular-movies', moviesData, 'movie');
            renderRow('row-top-movies', topMovies.results, 'movie');
            renderRow('row-popular-tv', tvData, 'tv');
            renderRow('row-top-tv', topTV.results, 'tv');

            const recosData = [...moviesData.slice(0, 8).map(i => ({...i, media_type: 'movie'})), 
                               ...tvData.slice(0, 7).map(i => ({...i, media_type: 'tv'}))];
            recosData.sort(() => Math.random() - 0.5);
            renderRecommendations('row-search-recos', recosData); 

            setupSearchListeners(mobileSearchInput);
            setupSearchListeners(pcSearchInput);

            switchTab('movies');
        }

        // --- HERO SLIDESHOW LOGIC ---
        function startSlideshow(data, type) {
            if(!data || data.length === 0) return;
            if(slideInterval) clearInterval(slideInterval);
            
            activeSlideData = data;
            currentSlideIndex = 0;
            const isMobile = window.innerWidth <= 768;

            const updateFunction = isMobile ? updateMobileHero : updatePCHero;
            updateFunction(activeSlideData[0], type);
            
            slideInterval = setInterval(() => {
                currentSlideIndex = (currentSlideIndex + 1) % activeSlideData.length;
                updateFunction(activeSlideData[currentSlideIndex], type);
            }, 6000);
        }

        async function updatePCHero(item, type) {
            const contentBox = document.getElementById('pc-hero-content-box');
            contentBox.style.opacity = 0;
            const logoPath = await getMovieLogo(item.id, type);
            const targetUrl = type === 'movie' ? `${APP_URL}player.html?${item.id}` : `${APP_URL}show.html?${item.id}`;
            
            setTimeout(() => {
                const titleContainer = document.getElementById('hero-title-container');
                const bg = document.getElementById('hero-bg');
                const desc = document.getElementById('hero-desc');
                const rating = document.getElementById('hero-rating');
                const typeLabel = document.getElementById('hero-type');
                const btn = document.getElementById('hero-play');

                if (logoPath) titleContainer.innerHTML = `<img src="https://image.tmdb.org/t/p/w500${logoPath}" alt="${item.title || item.name} logo" class="hero-logo">`;
                else titleContainer.innerHTML = `<h1 id="hero-title">${item.title || item.name}</h1>`;
                
                desc.textContent = item.overview;
                rating.textContent = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
                typeLabel.textContent = type === 'movie' ? 'TRENDING MOVIE' : 'TRENDING SERIES';
                btn.href = targetUrl;
                
                const imgPath = item.backdrop_path || item.poster_path;
                if(imgPath) bg.style.backgroundImage = `url('${IMG_BACKDROP}${imgPath}')`;
                
                contentBox.style.opacity = 1;
            }, 500); 
        }
        
        async function updateMobileHero(item, type) {
            const slideContainer = document.getElementById('mobile-hero-slide');
            slideContainer.style.opacity = 0;

            const logoPath = await getMovieLogo(item.id, type);
            const targetUrl = type === 'movie' ? `${APP_URL}player.html?${item.id}` : `${APP_URL}show.html?${item.id}`;
            const imagePath = item.backdrop_path || item.poster_path;

            setTimeout(() => {
                slideContainer.innerHTML = `
                    <div class="mobile-hero-poster-box">
                        <img src="${IMG_BACKDROP}${imagePath}" alt="${item.title || item.name}" class="backdrop-art">
                        <div class="mobile-hero-overlay-gradient"></div>
                        
                        <div class="mobile-hero-content">
                            ${logoPath 
                                ? `<img src="https://image.tmdb.org/t/p/w300${logoPath}" alt="${item.title || item.name} logo" class="mobile-hero-logo">` 
                                : `<h2 style="font-size: 1.5rem; margin: 0 0 15px 0; color: white; text-shadow: 0 2px 5px rgba(0,0,0,0.8);">${item.title || item.name}</h2>`
                            }
                            <a href="${targetUrl}" class="mobile-hero-play">
                                <i class="fas fa-play"></i> Watch
                            </a>
                        </div>
                    </div>
                `;
                slideContainer.style.opacity = 1;
            }, 500); 
        }

        // --- NAVIGATION & SEARCH LOGIC ---
        function switchTab(tab) {
            const movieSection = document.getElementById('view-movies');
            const tvSection = document.getElementById('view-tv');
            const browseView = document.getElementById('browse-view');
            const searchView = document.getElementById('search-view');
            const searchRecos = document.getElementById('search-recommendations');
            const searchResultsContainer = document.querySelector('.search-results-container');
            
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.bottom-nav .nav-item').forEach(el => el.classList.remove('active'));
            
            const activeTopBtn = document.getElementById(`tab-${tab}`);
            if(activeTopBtn) activeTopBtn.classList.add('active');
            
            const activeBottomBtn = document.querySelector(`.bottom-nav .nav-item[onclick*="switchTab('${tab}')"]`);
            if(activeBottomBtn) activeBottomBtn.classList.add('active');

            // Clear search inputs when switching back to browse view
            mobileSearchInput.value = '';
            pcSearchInput.value = '';
            document.getElementById('search-grid').innerHTML = '';
            searchResultsContainer.style.display = 'none';

            if (tab === 'movies' || tab === 'tv') {
                browseView.classList.remove('visually-hidden');
                searchView.classList.add('visually-hidden');

                movieSection.classList.add('is-fading');
                tvSection.classList.add('is-fading');
                
                setTimeout(() => {
                    movieSection.classList.add('visually-hidden');
                    tvSection.classList.add('visually-hidden');
                    
                    if (tab === 'movies') {
                        movieSection.classList.remove('visually-hidden');
                        startSlideshow(moviesData, 'movie');
                    } else if (tab === 'tv') {
                        tvSection.classList.remove('visually-hidden');
                        startSlideshow(tvData, 'tv');
                    }
                    
                    requestAnimationFrame(() => {
                        movieSection.classList.remove('is-fading');
                        tvSection.classList.remove('is-fading');
                    });
                }, 300); 
                
            } else if (tab === 'search') {
                // This block is primarily for the mobile bottom nav 'Search' button
                browseView.classList.add('visually-hidden');
                searchView.classList.remove('visually-hidden');
                if (slideInterval) clearInterval(slideInterval);
                
                // Show popular searches unless there's already a query synced from PC
                if (mobileSearchInput.value.trim().length === 0) {
                    searchRecos.style.display = 'block';
                    searchResultsContainer.style.display = 'none';
                }
                mobileSearchInput.focus();
            }
        }

        function setupSearchListeners(inputElement) {
            inputElement.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                clearTimeout(searchTimeout);
                
                const isMobile = window.innerWidth <= 768;
                const recos = document.getElementById('search-recommendations');
                const resultsContainer = document.querySelector('.search-results-container');
                const resultsTitle = document.getElementById('search-results-title');
                const browseView = document.getElementById('browse-view');
                const searchView = document.getElementById('search-view');
                
                // Sync the other input (keeps both search bars' content updated)
                const otherInput = (inputElement === mobileSearchInput) ? pcSearchInput : mobileSearchInput;
                otherInput.value = query;

                // PC: Switch to search view immediately upon typing
                if (!isMobile) {
                    if (query.length > 0) {
                        browseView.classList.add('visually-hidden');
                        searchView.classList.remove('visually-hidden');
                    } else {
                        // PC: If query is cleared, switch back to movies tab
                        switchTab('movies'); 
                        return; // Exit to avoid running search logic on clear
                    }
                }
                
                // Mobile/PC Logic for Search Results
                if(query.length > 2) {
                    recos.style.display = 'none';
                    resultsContainer.style.display = 'block';
                    resultsTitle.textContent = `Search Results for "${query}"`;
                    searchTimeout = setTimeout(() => doSearch(query), 500);
                } else if (query.length === 0) {
                    // Mobile: Show recommendations when cleared
                    if (isMobile) {
                        recos.style.display = 'block';
                        resultsContainer.style.display = 'none';
                    }
                    document.getElementById('search-grid').innerHTML = '';
                } else {
                    // Mobile: Typing but less than 3 chars
                    resultsContainer.style.display = 'none';
                    recos.style.display = 'block';
                }
            });
        }
        
        async function doSearch(query) {
            const data = await fetchData('/search/multi', `&query=${encodeURIComponent(query)}`);
            const grid = document.getElementById('search-grid');
            grid.innerHTML = '';
            
            if(data.results && data.results.length) {
                data.results.forEach(item => {
                    if((item.media_type === 'movie' || item.media_type === 'tv') && item.poster_path) {
                        grid.appendChild(createCard(item, item.media_type));
                    }
                });
            } else {
                 grid.innerHTML = `<p style="text-align: center; color: #777; padding: 50px;">No results found for "${query}".</p>`;
            }
        }

        window.addEventListener('scroll', () => {
            const h = document.getElementById('main-header');
            if(window.scrollY > 50) h.classList.add('scrolled');
            else h.classList.remove('scrolled');
        });

        init();
    </script>
</body>
</html>
